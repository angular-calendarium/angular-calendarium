!function(){"use strict";angular.module("ngCalendarium",[]).constant("calendarConfig",{template:['<div class="calendarium">','<div class="header">','<button class="previous" ng-click="previousMonth()" title="previous month" ><<</button>',"<h1>{{monthLabel}}/{{yearLabel}}</h1>",'<button class="next" ng-click="nextMonth()" title="next month" >>></button>',"</div>",'<ol class="day-names clear">','<li ng-repeat="weekDay in weekDays">{{weekDay}}</li>',"</o>",'<ol class="days">','<li ng-repeat="date in dates">','<div ng-if="!isDate(date)" class="date empty"></div>','<div ng-if="isDate(date)" class="date" ng-click="selectDate(date)">{{date.getDate()}}</div>',"</li>","</ol>","</div>"].join(""),day_labels:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],month_labels:["January","February","March","April","May","June","July","August","September","October","November","December"],days_in_month:[31,28,31,30,31,30,31,31,30,31,30,31]}).service("calendariumService",["calendarConfig","$http","$q",function(e,t,a){var n=this;n.getDateIntervals=function(t,a){var n,r,i=new Date(t,a,1),s=[];r=e.days_in_month[a],1===a&&(t%4===0&&t%100!==0||t%400===0)&&(r+=1);for(var l=1;r>=l;l++)s.push(l);return n=new Date(t,a,s.length),{firstWeekDate:i.getDay(),firstDate:i,lastDate:n,days:s}},n.loadCalendarDates=function(e,r,i){var s=a.defer();if(!e)return s.resolve(n.getDateIntervals(r,i)),s.promise;var l=n.getDateIntervals(r,i);return t({url:e,method:"GET",params:{firstDate:l.firstDate.toISOString(),lastDate:l.lastDate.toISOString()}}).then(function(e){var t=angular.extend({dates:e.data},l);return t},function(e){throw e})}}]).directive("calendarium",["$parse","calendarConfig","calendariumService",function(e,t,a){return{restrict:"E",replace:!0,scope:{month:"@",year:"@",onDateSelected:"&",url:"@"},template:t.template,link:function(e){var n=e.onDateSelected();e._year=null===e.year||isNaN(e.year)?(new Date).getFullYear():e.year,e._month=null===e.month||isNaN(e.month)?(new Date).getMonth():e.month,e.weekDays=t.day_labels,e.isDate=function(e){return e instanceof Date},e.selectDate=function(e){n&&n(e)},e.previousMonth=function(){0===e._month?(e._month=11,e._year=e._year-1):e._month=e._month-1,e.render()},e.nextMonth=function(){11===e._month?(e._month=0,e._year=e._year+1):e._month=e._month+1,e.render()},e.render=function(){var n=a.loadCalendarDates(e.url,e._year,e._month);n.then(function(a){e.monthLabel=t.month_labels[a.firstDate.getMonth()],e.yearLabel=a.firstDate.getFullYear(),e.dates=[];for(var n=0;n<a.days.length;n++)e.dates.push(new Date(a.firstDate.getFullYear(),a.firstDate.getMonth(),a.days[n]));if(0!==a.firstDate.getDay())for(var r=0;r<a.firstDate.getDay();r++)e.dates.unshift({day:r});if(e.dates.length%7!==0)for(var i=e.dates.length%7,s=0;7-i>s;s++)e.dates.push({day:s});e.dates=e.dates},function(e){throw e})},e.render()}}}])}();