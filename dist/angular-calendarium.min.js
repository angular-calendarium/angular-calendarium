!function(){"use strict";angular.module("ngCalendarium",[]).constant("calendarConfig",{template:['<div class="calendarium-container">','<div class="calendarium" ng-hide="fetchingData">','<div class="header">','<button class="previous" ng-click="previousMonth()" title="previous month" ><<</button>',"<h1>{{monthLabel}}/{{yearLabel}}</h1>",'<button class="next" ng-click="nextMonth()" title="next month" >>></button>',"</div>",'<ol class="calendarium-day-names clear">','<li ng-repeat="weekDay in weekDays">{{weekDay[day_label]}}</li>',"</o>",'<ol class="calendarium-days">','<li ng-repeat="dateContainer in dateContainers" title="{{dateContainer.state.tooltip}}">','<div ng-if="dateContainer.state.disabled" class="date disabled" ng-class="dateContainer.state.className">{{dateContainer.date.getDate()}}</div>','<div ng-if="!dateContainer.state.disabled && !isDate(dateContainer.date)" class="date empty"></div>','<div ng-if="!dateContainer.state.disabled && isDate(dateContainer.date)" ng-class="dateContainer.state.className" class="date" ng-click="selectDate(dateContainer.date,dateContainer.state)">{{dateContainer.date.getDate()}}</div>',"</li>","</ol>","</div>",'<div class="loading" ng-show="fetchingData">',"<div>fetching data...</div>","</div>","<div>"].join(""),default_day_label:"abbr",day_labels:[{full:"Sunday",day:"Sun",abbr:"S"},{full:"Monday",day:"Mon",abbr:"M"},{full:"Tuesday",day:"Tue",abbr:"T"},{full:"Wednesday",day:"Wed",abbr:"W"},{full:"Thursday",day:"Thu",abbr:"T"},{full:"Friday",day:"Fri",abbr:"F"},{full:"Saturday",day:"Sat",abbr:"S"}],month_labels:["January","February","March","April","May","June","July","August","September","October","November","December"],days_in_month:[31,28,31,30,31,30,31,31,30,31,30,31]}).factory("_",["$window",function(e){return e._}]).service("calendariumService",["calendarConfig","$http","$q",function(e,a,t){var n=this;n.getDateIntervals=function(a,t){var n,r,i=new Date(a,t,1),d=[];r=e.days_in_month[t],1===t&&(a%4===0&&a%100!==0||a%400===0)&&(r+=1);for(var l=1;r>=l;l++)d.push(l);return n=new Date(a,t,d.length),{firstWeekDate:i.getDay(),firstDate:i,lastDate:n,days:d}},n.loadCalendarDates=function(e,r,i,d){var l=t.defer();if(!e)return l.resolve(n.getDateIntervals(r,i)),l.promise();var s=n.getDateIntervals(r,i);return a({url:e,method:"GET",params:angular.extend({firstDate:s.firstDate.toISOString(),lastDate:s.lastDate.toISOString()},d||{})}).then(function(e){var a=angular.extend({dates:e.data},s);return a},function(e){throw e})}}]).directive("calendarium",["$parse","calendarConfig","calendariumService","_",function(e,a,t,n){return{restrict:"E",replace:!0,scope:{month:"@",year:"@",onDateSelected:"&",url:"@",params:"="},template:a.template,link:function(e){var r=e.onDateSelected();e._year=null===e.year||isNaN(e.year)?(new Date).getFullYear():e.year,e._month=null===e.month||isNaN(e.month)?(new Date).getMonth():e.month,e.weekDays=a.day_labels,e.day_label=a.default_day_label,e.isDate=function(e){return e instanceof Date},e.selectDate=function(e,a){r&&r(e,a)},e.previousMonth=function(){0===e._month?(e._month=11,e._year=e._year-1):e._month=e._month-1,e.render()},e.nextMonth=function(){11===e._month?(e._month=0,e._year=e._year+1):e._month=e._month+1,e.render()},e.render=function(){e.fetchingData=!0,t.loadCalendarDates(e.url,e._year,e._month,e.params).then(function(t){if(e.monthLabel=a.month_labels[t.firstDate.getMonth()],e.yearLabel=t.firstDate.getFullYear(),e.dateContainers=[],n.each(t.days,function(a){var r={date:new Date(t.firstDate.getFullYear(),t.firstDate.getMonth(),a),state:n.findWhere(t.dates,{day:a})||{disabled:!1}};e.dateContainers.push(r)}),0!==t.firstDate.getDay())for(var r=0;r<t.firstDate.getDay();r++)e.dateContainers.unshift({date:r,state:{disabled:!1}});if(e.dateContainers.length%7!==0)for(var i=e.dateContainers.length%7,d=0;7-i>d;d++)e.dateContainers.push({date:d,state:{disabled:!1}});e.fetchingData=!1},function(a){throw e.fetchingData=!1,a})},e.render()}}}])}();